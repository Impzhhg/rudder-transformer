bindings:
  - name: EventType
    path: ../../../../constants
  - path: ../../bindings/jsontemplate
    exportAll: true
  - path: ./config
  - name: removeUndefinedAndNullValues
    path: ../../../../v0/util
  - name: defaultRequestConfig
    path: ../../../../v0/util
  - path: ./utils

steps:
  - name: validateInput
    template: |
      $.assert(Array.isArray(^) && ^.length > 0, "Invalid event array")

  - name: generatePayload
    template: |
      $.combinePayloads(^.{.message.type === $.EventType.IDENTIFY}[], ^[0].destination)

  - name: finalPayload
    description: build response
    template: |
      const response = $.defaultRequestConfig();
      response.body.JSON = $.outputs.generatePayload
      response
